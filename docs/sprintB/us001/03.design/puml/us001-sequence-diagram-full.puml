@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Human Resources Manager" as HRM
participant ":RegisterSkillUI" as UI
participant ":RegisterSkillController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "skillCategoryRepository\n:skillCategoryRepository" as skillRepository
participant ":ApplicationSession" as _APP
participant "appSession\n:ApplicationSession" as APP
participant "currentSession\n:UserSession" as SESSAO
participant "organizationRepository:\nOrganizationRepository" as OrganizationRepository
participant "organization\n:Organization" as ORG
participant "skill\n:Skill" as EMPREGO

activate HRM

        HRM -> UI : asks to register a new skill

        activate UI

            UI -> CTRL** : register

            UI -> CTRL : getSkillCategories()
            activate CTRL

                CTRL -> RepositorySingleton : getInstance()
                activate RepositorySingleton

                    RepositorySingleton --> CTRL: repositories
                deactivate RepositorySingleton

                CTRL -> PLAT : getSkillCategoryRepository()
                activate PLAT

                    PLAT --> CTRL: skillCategoryRepository
                deactivate PLAT

                CTRL -> skillRepository : getSkillCategories()
                activate skillRepository

                    skillRepository --> CTRL : skillCategoryList
                deactivate skillRepository

                CTRL --> UI : skillCategoryList
            deactivate CTRL

            UI --> HRM : request data (name)
        deactivate UI

    HRM -> UI : types requested data (name)
    activate UI

        UI --> HRM : shows selected category and requested data
        deactivate UI

        HRM -> UI : submits data
            activate UI


            UI -> CTRL : registerSkill(name)
            activate CTRL

                activate CTRL

                    CTRL -> RepositorySingleton : getInstance()
                    activate RepositorySingleton

                        RepositorySingleton --> CTRL: repositories
                    deactivate RepositorySingleton

                    CTRL -> PLAT : getJobCategoryRepository()
                    activate PLAT

                        PLAT -> CTRL : jobCategoryRepository
                    deactivate PLAT

                    CTRL -> skillRepository : getJobCategoryByDescription(jobCategoryDescription)
                    activate skillRepository

                        skillRepository --> CTRL : jobCategory
                    deactivate skillRepository
                        CTRL --> CTRL : jobCategory
                deactivate CTRL

                |||
                CTRL -> CTRL : getEmployeeFromSession()
                activate CTRL

                    CTRL -> _APP: getInstance()
                    activate _APP
                        _APP -> CTRL: appSession
                    deactivate _APP


                    CTRL -> APP: getCurrentSession()
                    activate APP

                        APP --> CTRL: currentSession
                    deactivate APP

                    CTRL -> SESSAO: email = getUserEmail()
                    activate SESSAO

                        SESSAO --> CTRL: email
                    deactivate SESSAO


                    CTRL -> PLAT: getOrganizationRepository(email)
                    activate PLAT

                        PLAT --> CTRL: organizationRepository
                    deactivate PLAT


                    CTRL -> OrganizationRepository: getOrganizationByEmployeeEmail(email)
                    activate OrganizationRepository

                        loop [for each employee
                            OrganizationRepository -> ORG : anyEmployeeHasEmail(email)
                            activate ORG

                                 ORG --> OrganizationRepository : true/false
                            deactivate ORG
                        end
                        OrganizationRepository --> CTRL : organization
                    deactivate OrganizationRepository

                    CTRL -> ORG: getEmployeeByEmail(email)
                    activate ORG

                        ORG --> CTRL : employee
                    deactivate ORG

                    CTRL --> CTRL : employee
                deactivate CTRL

                |||
                CTRL -> ORG: registerSkill(employee, name)
                activate ORG

                    ORG -> EMPREGO**: register(employee, name)

                    ORG -> ORG: addSkill(skill)


                    activate ORG
                        ORG -> ORG: validateSkill(skill)
                        activate ORG
                            ORG --> ORG
                        deactivate ORG

                        ORG --> ORG
                    deactivate ORG

                    ORG --> CTRL : skill

                deactivate ORG

                CTRL --> UI: skill
                deactivate CTRL
                UI --> HRM: Confirms the success of the operation.
        deactivate UI
    deactivate HRM

@enduml